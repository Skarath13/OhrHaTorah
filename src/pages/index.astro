---
import BaseLayout from '../layouts/BaseLayout.astro';
import Header from '../components/layout/Header.astro';
import Navigation from '../components/layout/Navigation.astro';
import Footer from '../components/layout/Footer.astro';
import ParashahCard from '../components/islands/ParashahCard.astro';
import CandleLighting from '../components/islands/CandleLighting.astro';
import AdminModal from '../components/AdminModal.astro';
import { rabbi } from '../data/rabbi';
---

<BaseLayout>
    <Header />
    <Navigation />

    <!-- Main Container -->
    <div class="container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-widget">
                <div class="widget-header" data-editable="sidebar-welcome-header"><i class="fas fa-star-of-david"></i> <span data-editable="sidebar-welcome-title">Shalom Visitor!</span></div>
                <div class="widget-content">
                    <ul class="sidebar-list">
                        <li><a href="/services"><i class="fas fa-chevron-right"></i> Worship Times</a></li>
                        <li><a href="https://www.google.com/maps/place/Kehilat+OhrHaTorah+Messianic+Jewish+Synagogue/@33.7175,-117.9366,17z/" target="_blank" rel="noopener noreferrer"><i class="fas fa-chevron-right"></i> Directions to OC Location</a></li>
                        <li><a href="/faq"><i class="fas fa-chevron-right"></i> Frequently Asked Questions</a></li>
                    </ul>
                </div>
            </div>

            <div class="sidebar-widget">
                <div class="widget-header" data-editable="sidebar-mission-header"><i class="fas fa-bullseye"></i> <span data-editable="sidebar-mission-title">Our Mission</span></div>
                <div class="widget-content">
                    <div class="mission-text">
                        <p data-editable="mission-statement">To create a welcoming community where Jewish and non-Jewish people can explore the rich heritage of Judaism while embracing Yeshua as the promised Messiah of Israel. We are committed to living out Torah principles, celebrating biblical feasts, and growing together in faith and understanding.</p>
                        <div class="mission-highlights">
                            <div class="highlight-item">
                                <i class="fas fa-heart"></i>
                                <span>Welcoming Community</span>
                            </div>
                            <div class="highlight-item">
                                <i class="fas fa-torah"></i>
                                <span>Torah Living</span>
                            </div>
                            <div class="highlight-item">
                                <i class="fas fa-hands-praying"></i>
                                <span>Faithful Worship</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-widget">
                <div class="widget-header" data-editable="sidebar-vision-header"><i class="fas fa-eye"></i> <span data-editable="sidebar-vision-title">Our Vision</span></div>
                <div class="widget-content">
                    <div class="vision-text">
                        <p data-editable="vision-statement">To be a light to the nations, demonstrating the unity of Scripture and the fulfillment of God's promises through Yeshua. We envision a thriving Messianic Jewish community that bridges Jewish and Gentile believers, preserving Jewish heritage while proclaiming the Gospel to all peoples.</p>
                        <div class="vision-goals">
                            <div class="goal-item">
                                <i class="fas fa-globe-americas"></i>
                                <span>Light to Nations</span>
                            </div>
                            <div class="goal-item">
                                <i class="fas fa-bridge"></i>
                                <span>Unity in Messiah</span>
                            </div>
                            <div class="goal-item">
                                <i class="fas fa-crown"></i>
                                <span>Kingdom Living</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-widget">
                <div class="widget-header" data-editable="sidebar-values-header"><i class="fas fa-gem"></i> <span data-editable="sidebar-values-title">Core Values</span></div>
                <div class="widget-content">
                    <div class="values-list-compact">
                        <div class="value-item-compact">
                            <h4 data-editable="value-torah-title">Torah Faithfulness <i class="fas fa-scroll"></i></h4>
                            <p data-editable="value-torah-desc">Living according to God's eternal instructions</p>
                        </div>
                        <div class="value-item-compact">
                            <h4 data-editable="value-identity-title">Jewish Identity <i class="fas fa-star-of-david"></i></h4>
                            <p data-editable="value-identity-desc">Celebrating our rich Jewish heritage and traditions</p>
                        </div>
                        <div class="value-item-compact">
                            <h4 data-editable="value-messiah-title">Yeshua as Messiah <i class="fas fa-star-of-david"></i></h4>
                            <p data-editable="value-messiah-desc">Embracing Jesus as Israel's promised Redeemer</p>
                        </div>
                        <div class="value-item-compact">
                            <h4 data-editable="value-community-title">Loving Community <i class="fas fa-hands-helping"></i></h4>
                            <p data-editable="value-community-desc">Welcoming all who seek to grow in faith</p>
                        </div>
                        <div class="value-item-compact">
                            <h4 data-editable="value-study-title">Biblical Study <i class="fas fa-book-open"></i></h4>
                            <p data-editable="value-study-desc">Commitment to deep Scripture learning and understanding</p>
                        </div>
                        <div class="value-item-compact">
                            <h4 data-editable="value-worship-title">Authentic Worship <i class="fas fa-pray"></i></h4>
                            <p data-editable="value-worship-desc">Heartfelt praise through Jewish liturgy and tradition</p>
                        </div>
                        <div class="value-item-compact">
                            <h4 data-editable="value-growth-title">Spiritual Growth <i class="fas fa-seedling"></i></h4>
                            <p data-editable="value-growth-desc">Encouraging maturity in faith and character</p>
                        </div>
                        <div class="value-item-compact">
                            <h4 data-editable="value-compassion-title">Compassionate Service <i class="fas fa-heart"></i></h4>
                            <p data-editable="value-compassion-desc">Serving others with love and practical care</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="sidebar-widget">
                <div class="widget-header" data-editable="sidebar-prayer-header">
                    <i class="fas fa-clock"></i> <span data-editable="sidebar-prayer-title">Prayer Times</span>
                </div>
                <div class="widget-content">
                    <div class="prayer-times">
                        <div class="prayer-row">
                            <div class="prayer-name" data-editable="prayer-shacharit-name"><i class="fas fa-sun"></i> Shacharit</div>
                            <div class="prayer-time" id="shacharit-time">Loading...</div>
                        </div>
                        <div class="prayer-row">
                            <div class="prayer-name" data-editable="prayer-mincha-name"><i class="fas fa-cloud-sun"></i> Mincha</div>
                            <div class="prayer-time" id="mincha-time">Loading...</div>
                        </div>
                        <div class="prayer-row">
                            <div class="prayer-name" data-editable="prayer-maariv-name"><i class="fas fa-moon"></i> Ma'ariv</div>
                            <div class="prayer-time" id="maariv-time">Loading...</div>
                        </div>
                    </div>
                    <div class="prayer-last-updated" id="prayer-last-updated">
                        <span class="live-indicator" id="prayer-live-indicator" title="Live from Hebcal">
                            <span class="live-dot"></span>
                            <span class="live-text">LIVE</span>
                        </span>
                        <span class="updated-time" id="prayer-updated-time"></span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <h1 data-editable="main-title"><i class="fas fa-star-of-david"></i> <span data-editable="main-title-text">Welcome to Kehilat Ohr HaTorah Messianic Jewish Synagogue</span></h1>

            <div class="infobox">
                <i class="fas fa-info-circle"></i>
                <strong>Shabbat Service This Week:</strong> Join us each Saturday at 2:30 p.m. for contemporary Messianic Jewish music and dance, a traditional Mincha Torah Service, and Scripture study at our Fountain Valley location.
            </div>

            <p data-editable="intro-text-1"><strong>Kehilat Ohr HaTorah</strong> is a newly developing Messianic Jewish Synagogue located in the heart of Orange County, California. We warmly welcome all Jewish, non-Jewish, and interfaith couples and families – all who desire to experience and grow in the deep richness of Jewish life, thought, and tradition.</p>

            <p data-editable="intro-text-2">Ours is a home where the teachings of Torah and the teachings of our Messiah Yeshua come together as one, where we as life-long learners of the Bible and of Judaism can grow together — with love, respect, and mutual understanding. We look forward to you visiting us soon!</p>

            <div class="ticker-banner">
                <div class="ticker-content">
                    <span class="ticker-item">
                        <i class="fas fa-scroll"></i>
                        God's Torah, "It is a Tree of Life [etz chaim] for those who take hold of it, and happy are those who uphold it. Its ways are ways of pleasantness, and all its paths are peace (Proverbs 3:17-18). Turn us back to you, HASHEM, and we shall be restored. Renew our lives as in days of old (Lamentations 5:21).
                    </span>
                    <span class="ticker-item">
                        <i class="fas fa-scroll"></i>
                        God's Torah, "It is a Tree of Life [etz chaim] for those who take hold of it, and happy are those who uphold it. Its ways are ways of pleasantness, and all its paths are peace (Proverbs 3:17-18). Turn us back to you, HASHEM, and we shall be restored. Renew our lives as in days of old (Lamentations 5:21).
                    </span>
                </div>
            </div>

            <h3 id="congregation-calendar"><i class="fas fa-calendar-alt"></i> Congregation Calendar</h3>

            <div class="calendar-container">
                <div class="responsive-calendar">
                    <iframe src="https://calendar.google.com/calendar/embed?src=ohrhatorahoc%40gmail.com&ctz=America%2FLos_Angeles"
                            style="border: 0"
                            width="800"
                            height="200"
                            frameborder="0"
                            scrolling="no">
                    </iframe>
                </div>
            </div>

            <h3 data-editable="about-us-title"><i class="fas fa-users"></i> <span data-editable="about-us-title-text">About Us</span></h3>

            <p data-editable="about-us-text-1">Kehilat Ohr HaTorah is a newly developing Messianic Synagogue in the heart of Orange County, California. As followers of Messianic Judaism, we honor and practice traditional Judaism while joyfully serving our Jewish Messiah, Yeshua. We emphasize Yeshua's call to pursue covenant faithfulness with our God and with all our Jewish people. Within this framework, we warmly welcome all Jewish, non-Jewish, and interfaith couples and families who desire to experience and grow in the freedom and richness of our Messianic Jewish faith.</p>

            <p data-editable="about-us-text-2">Our community and services are ideal both for those who are inquiring and for those who seek to deepen their understanding and walk with our Jewish Messiah. We blend traditional and contemporary Jewish practices – emphasizing in our services community prayer (in Hebrew and English), Scripture teaching, and vibrant music.</p>

            <p data-editable="about-us-text-3">At the head of our leadership team is Rabbi Charles (Chaim) Ott who brings with him many years of experience in Messianic leadership, having completed extensive graduate work in Jewish studies, New Testament studies and public Education. Rabbi Ott is especially passionate and skilled in his presentation of the entire Bible – Hebrew Scriptures and Brit Chadashah (New Testament) – as one unified message of individual and national redemption through Yeshua our Messiah.</p>

            <p data-editable="about-us-text-4">Congregation Ohr HaTorah is newly affiliated with the <a href="https://www.umjc.org/vision" target="_blank" rel="noopener noreferrer">Union of Messianic Jewish Synagogues (UMJC)</a>. As stated on its website, the UMJC spearheads a "movement of Jewish congregations and groups committed to Yeshua the Messiah that embrace the covenantal responsibility of Jewish life and identity rooted in Torah, expressed in tradition, and renewed and applied in the context of the New Covenant."</p>

            <div class="info-grid">
                <div class="info-box" id="shabbat-activities-section">
                    <h4><i class="fas fa-clock"></i> Shabbat Activities and Service</h4>
                    <div data-editable="service-times">
                        <p><strong>Friday Evening:</strong><br>
                        Festive Shabbat meals in the home</p>

                        <p><strong>Saturday Service Schedule:</strong><br>
                        <span class="time-highlight blue">2:30 PM</span> - Messianic Jewish Music and Dance<br>
                        <span class="time-highlight gold">3:00 PM</span> - Traditional prayers and Torah Service (Mincha)<br>
                        <span class="time-highlight green">4:30 PM</span> - Discussion on Weekly Readings</p>

                        <p><em>We plan soon to offer a morning service (Shacharit)</em></p>
                    </div>
                </div>
                <div class="info-box">
                    <h4><i class="fas fa-map"></i> Google Maps</h4>
                    <div class="map-container">
                        <iframe src="https://maps.google.com/maps?q=Kehilat+OhrHaTorah+Messianic+Jewish+Synagogue,Fountain+Valley,CA&t=&z=15&ie=UTF8&iwloc=&output=embed"
                                width="100%"
                                height="100%"
                                style="border:0;"
                                allowfullscreen=""
                                loading="lazy"
                                referrerpolicy="no-referrer-when-downgrade">
                        </iframe>
                    </div>
                    <div class="map-directions-container" style="width: 100%; overflow: hidden;">
                        <a href="https://www.google.com/maps/place/Kehilat+OhrHaTorah+Messianic+Jewish+Synagogue/@33.7175,-117.9366,17z/"
                           target="_blank"
                           rel="noopener noreferrer"
                           class="btn btn-blue"
                           style="margin-top: var(--space-sm); padding: 0.5rem 1rem; justify-content: center; display: flex; align-items: center; gap: 0.5rem; font-size: var(--font-size-sm); box-sizing: border-box;">
                            <i class="fas fa-directions"></i>
                            Get Directions
                        </a>
                    </div>
                </div>
                <div class="info-box" id="contact-us-section">
                    <h4><i class="fas fa-envelope"></i> Contact Us</h4>
                    <div data-editable="contact-info">
                        <p><strong>Mailing Address:</strong><br>
                        360 E. 1st Street, #856<br>
                        Tustin, CA 92780</p>

                        <p><strong><i class="fas fa-envelope"></i> Email:</strong> <a href="mailto:OhrHaTorahOC@gmail.com">OhrHaTorahOC@gmail.com</a></p>

                        <p><strong><i class="fas fa-phone"></i> Phone:</strong> <a href="tel:+17144061513">(714) 406-1513</a></p>
                    </div>
                </div>
                <div class="info-box">
                    <h4><i class="fas fa-map-marker-alt"></i> Location</h4>
                    <p data-editable="location-text"><strong>Service Location:</strong><br>
                    10460 Slater Ave<br>
                    Fountain Valley, CA 92708</p>
                </div>
            </div>
        </main>

        <!-- Right Sidebar -->
        <aside class="right-sidebar">
            <ParashahCard />
            <CandleLighting />

            <!-- Leadership Card -->
            <div class="feature-card leader-card">
                <div class="card-header">
                    <i class="fas fa-user-tie"></i>
                    <span data-editable="rabbi-card-title">Meet Our Rabbi</span>
                </div>
                <div class="card-body text-center">
                    <div class="leader-img">
                        <img src={rabbi.image} alt={rabbi.name} style="width: 100%; height: 100%; object-fit: cover; object-position: center top; transform: scale(1.05);">
                    </div>
                    <div class="leader-name" data-editable="rabbi-name">{rabbi.name}</div>
                    <div class="leader-title" data-editable="rabbi-title">{rabbi.title}</div>
                    <p class="leader-bio" data-editable="rabbi-bio">{rabbi.bio}</p>
                </div>
            </div>

            <!-- Community Life Card -->
            <div class="feature-card">
                <div class="card-header">
                    <i class="fas fa-images"></i>
                    <span data-editable="community-card-title">Community Life</span>
                </div>
                <div class="card-body">
                    <div class="community-grid">
                        <div class="community-item">
                            <img src="/images/Passover.PNG" alt="Passover Seder" class="community-image">
                        </div>
                        <div class="community-item">
                            <img src="/images/Location.PNG" alt="Our Synagogue" class="community-image">
                        </div>
                        <div class="community-item">
                            <img src="/images/Community.PNG" alt="Community Gathering" class="community-image">
                        </div>
                        <div class="community-item">
                            <img src="/images/Torah.PNG" alt="Torah" class="community-image">
                        </div>
                        <div class="community-item">
                            <img src="/images/Dancing.PNG" alt="Israeli Dancing" class="community-image">
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>

    <Footer />
    <AdminModal />

    <!-- Prayer Times Script - Using Hebcal Zmanim API -->
    <script>
        const HEBCAL_ZMANIM_ZIP = '92708'; // Fountain Valley, CA

        interface ZmanimTimes {
            sunrise: string;
            sunset: string;
            sofZmanShma: string;
            sofZmanTfilla: string;
            minchaGedola: string;
            minchaKetana: string;
            plagHaMincha: string;
            tzeit85deg: string;
            tzeit42min: string;
        }

        interface ZmanimResponse {
            date: string;
            location: {
                title: string;
                city: string;
                tzid: string;
            };
            times: ZmanimTimes;
        }

        const formatZmanTime = (isoDate: string): string => {
            const date = new Date(isoDate);
            return date.toLocaleTimeString('en-US', {
                hour: 'numeric',
                minute: '2-digit',
                hour12: true
            });
        };

        const loadPrayerTimes = async () => {
            const liveIndicator = document.getElementById('prayer-live-indicator');
            const lastUpdatedEl = document.getElementById('prayer-last-updated');

            try {
                const today = new Date();
                const dateStr = today.toISOString().split('T')[0];

                const response = await fetch(`https://www.hebcal.com/zmanim?cfg=json&zip=${HEBCAL_ZMANIM_ZIP}&date=${dateStr}`);
                if (!response.ok) throw new Error('API request failed');

                const data: ZmanimResponse = await response.json();

                if (data.times) {
                    // Shacharit: Use sunrise time (traditional earliest time for morning prayers)
                    const shacharitEl = document.getElementById('shacharit-time');
                    if (shacharitEl && data.times.sunrise) {
                        shacharitEl.textContent = formatZmanTime(data.times.sunrise);
                    }

                    // Mincha: Use Mincha Gedola (earliest time for afternoon prayers)
                    const minchaEl = document.getElementById('mincha-time');
                    if (minchaEl && data.times.minchaGedola) {
                        minchaEl.textContent = formatZmanTime(data.times.minchaGedola);
                    }

                    // Ma'ariv: Use Tzeit (nightfall, when 3 stars appear)
                    const maarivEl = document.getElementById('maariv-time');
                    if (maarivEl && data.times.tzeit85deg) {
                        maarivEl.textContent = formatZmanTime(data.times.tzeit85deg);
                    }

                    // Show live indicator
                    if (liveIndicator) {
                        liveIndicator.classList.add('active');
                    }

                    // Show last updated time
                    const updatedTimeEl = document.getElementById('prayer-updated-time');
                    if (updatedTimeEl) {
                        const now = new Date();
                        const timeStr = now.toLocaleTimeString('en-US', {
                            hour: 'numeric',
                            minute: '2-digit',
                            hour12: true
                        });
                        updatedTimeEl.textContent = `Updated ${timeStr} via Hebcal`;
                    }
                }
            } catch (error) {
                console.error('Error loading prayer times:', error);

                // Show error state
                if (lastUpdatedEl) {
                    lastUpdatedEl.textContent = 'Unable to load times';
                    lastUpdatedEl.style.color = '#e74c3c';
                }
            }
        };

        loadPrayerTimes();

        // Refresh every 30 minutes
        setInterval(loadPrayerTimes, 30 * 60 * 1000);
    </script>
</BaseLayout>
