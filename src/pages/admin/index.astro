---
// /admin redirects to login (or homepage if already logged in)
const runtime = Astro.locals.runtime;
if (runtime?.env?.DB) {
  const { validateSession, getSessionFromCookies } = await import('../../lib/auth');
  const cookieHeader = Astro.request.headers.get('cookie');
  const sessionId = getSessionFromCookies(cookieHeader);

  if (sessionId) {
    const user = await validateSession(runtime.env.DB, sessionId);
    if (user) {
      // Already logged in, go to homepage where Edit button will appear
      return Astro.redirect('/');
    }
  }
}

// Not logged in, redirect to login page
return Astro.redirect('/admin/login');
---
